<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Setting Up Lxd Lxc and K3s With a Basic Nginx Test Service | The world wide web, AI, me and my learnings!</title>
<meta name=keywords content><meta name=description content="Setting Up LXD, LXC, and K3s with a Basic NGINX Test Service
This guide details how to set up a lightweight Kubernetes (K3s) cluster using LXD and LXC containers on an Ubuntu 24.04 server, followed by deploying a basic NGINX test service with NGINX Ingress. These steps were tested on an Oracle Cloud Free Tier instance named maata-paarvati with 4 CPUs and 24 GB RAM.
Prerequisites

An Ubuntu 24.04 server (e.g., Oracle Cloud Free Tier instance).
Root or sudo access.
Network configured to allow TCP ports 80, 443, and 6443.


1. Install LXD


Install LXD via Snap:"><meta name=author content><link rel=canonical href=https://blog.rawlani.com/posts/setting-up-lxd-lxc-and-k3s-with-a-basic-nginx-test-service/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.rawlani.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.rawlani.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.rawlani.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.rawlani.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.rawlani.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.rawlani.com/posts/setting-up-lxd-lxc-and-k3s-with-a-basic-nginx-test-service/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.rawlani.com/posts/setting-up-lxd-lxc-and-k3s-with-a-basic-nginx-test-service/"><meta property="og:site_name" content="The world wide web, AI, me and my learnings!"><meta property="og:title" content="Setting Up Lxd Lxc and K3s With a Basic Nginx Test Service"><meta property="og:description" content="Setting Up LXD, LXC, and K3s with a Basic NGINX Test Service This guide details how to set up a lightweight Kubernetes (K3s) cluster using LXD and LXC containers on an Ubuntu 24.04 server, followed by deploying a basic NGINX test service with NGINX Ingress. These steps were tested on an Oracle Cloud Free Tier instance named maata-paarvati with 4 CPUs and 24 GB RAM.
Prerequisites An Ubuntu 24.04 server (e.g., Oracle Cloud Free Tier instance). Root or sudo access. Network configured to allow TCP ports 80, 443, and 6443. 1. Install LXD Install LXD via Snap:"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-21T17:35:27+05:30"><meta property="article:modified_time" content="2025-04-21T17:35:27+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setting Up Lxd Lxc and K3s With a Basic Nginx Test Service"><meta name=twitter:description content="Setting Up LXD, LXC, and K3s with a Basic NGINX Test Service
This guide details how to set up a lightweight Kubernetes (K3s) cluster using LXD and LXC containers on an Ubuntu 24.04 server, followed by deploying a basic NGINX test service with NGINX Ingress. These steps were tested on an Oracle Cloud Free Tier instance named maata-paarvati with 4 CPUs and 24 GB RAM.
Prerequisites

An Ubuntu 24.04 server (e.g., Oracle Cloud Free Tier instance).
Root or sudo access.
Network configured to allow TCP ports 80, 443, and 6443.


1. Install LXD


Install LXD via Snap:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.rawlani.com/posts/"},{"@type":"ListItem","position":2,"name":"Setting Up Lxd Lxc and K3s With a Basic Nginx Test Service","item":"https://blog.rawlani.com/posts/setting-up-lxd-lxc-and-k3s-with-a-basic-nginx-test-service/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setting Up Lxd Lxc and K3s With a Basic Nginx Test Service","name":"Setting Up Lxd Lxc and K3s With a Basic Nginx Test Service","description":"Setting Up LXD, LXC, and K3s with a Basic NGINX Test Service This guide details how to set up a lightweight Kubernetes (K3s) cluster using LXD and LXC containers on an Ubuntu 24.04 server, followed by deploying a basic NGINX test service with NGINX Ingress. These steps were tested on an Oracle Cloud Free Tier instance named maata-paarvati with 4 CPUs and 24 GB RAM.\nPrerequisites An Ubuntu 24.04 server (e.g., Oracle Cloud Free Tier instance). Root or sudo access. Network configured to allow TCP ports 80, 443, and 6443. 1. Install LXD Install LXD via Snap:\n","keywords":[],"articleBody":"Setting Up LXD, LXC, and K3s with a Basic NGINX Test Service This guide details how to set up a lightweight Kubernetes (K3s) cluster using LXD and LXC containers on an Ubuntu 24.04 server, followed by deploying a basic NGINX test service with NGINX Ingress. These steps were tested on an Oracle Cloud Free Tier instance named maata-paarvati with 4 CPUs and 24 GB RAM.\nPrerequisites An Ubuntu 24.04 server (e.g., Oracle Cloud Free Tier instance). Root or sudo access. Network configured to allow TCP ports 80, 443, and 6443. 1. Install LXD Install LXD via Snap:\nsudo snap install lxd Initialize LXD:\nUse default settings for a simple setup:\nsudo lxd init --auto This creates a dir storage pool (default) and a bridge network (lxdbr0).\nAdd User to LXD Group:\nsudo usermod -aG lxd ubuntu newgrp lxd Verify LXD:\nlxc list Should display an empty table initially. 2. Create a Kubernetes Profile for LXC Containers Create the Profile Configuration:\nSave this as k8s-profile.yaml:\nconfig: limits.cpu: \"2\" limits.memory: 2GB limits.memory.swap: \"false\" linux.kernel_modules: ip_tables,ip6_tables,nf_nat,overlay,br_netfilter raw.lxc: | lxc.apparmor.profile=unconfined lxc.cap.drop= lxc.cgroup.devices.allow=a lxc.mount.auto=proc:rw sys:rw security.privileged: \"true\" security.nesting: \"true\" security.syscalls.intercept.mknod: \"true\" security.syscalls.intercept.setxattr: \"true\" description: LXD profile for Kubernetes devices: eth0: name: eth0 nictype: bridged parent: lxdbr0 type: nic kmsg: path: /dev/kmsg source: /dev/console type: unix-char root: path: / pool: default type: disk name: k8s used_by: [] This matches your lxc config show kmaster --expanded output, excluding volatile and proxy settings added later.\nApply the Profile:\nlxc profile create k8s lxc profile edit k8s \u003c k8s-profile.yaml Verify Profile:\nlxc profile show k8s 3. Launch LXC Containers with Ubuntu 24.04 Initialize Containers:\nlxc init ubuntu:24.04 kmaster --profile k8s lxc init ubuntu:24.04 kworker1 --profile k8s lxc init ubuntu:24.04 kworker2 --profile k8s Start Containers:\nlxc start kmaster lxc start kworker1 lxc start kworker2 Verify Containers:\nlxc list Example output (IPs will vary):\n+---------+---------+----------------------+------+-----------+-----------+ | NAME | STATE | IPV4 | IPV6 | TYPE | SNAPSHOTS | +---------+---------+----------------------+------+-----------+-----------+ | kmaster | RUNNING | 10.177.108.101 (eth0)| | CONTAINER | 0 | | kworker1| RUNNING | 10.177.108.79 (eth0) | | CONTAINER | 0 | | kworker2| RUNNING | 10.177.108.57 (eth0) | | CONTAINER | 0 | +---------+---------+----------------------+------+-----------+-----------+ 4. Install K3s and Join the Cluster Prepare kmaster:\nlxc exec kmaster -- bash -c \"apt update \u0026\u0026 apt install -y curl iptables\" Install K3s on kmaster:\nDisable Traefik to use NGINX Ingress later:\nlxc exec kmaster -- bash -c \"curl -sfL https://get.k3s.io | sh -s - server --disable=traefik --write-kubeconfig-mode 644\" Get Node Token:\nlxc exec kmaster -- cat /var/lib/rancher/k3s/server/node-token Save the token (e.g., K10...::server:...). Prepare and Join Worker Nodes:\nFor kworker1:\nlxc exec kworker1 -- bash -c \"apt update \u0026\u0026 apt install -y curl iptables\" lxc exec kworker1 -- bash -c \"curl -sfL https://get.k3s.io | K3S_URL=https://10.177.108.101:6443 K3S_TOKEN= sh -\" For kworker2:\nlxc exec kworker2 -- bash -c \"apt update \u0026\u0026 apt install -y curl iptables\" lxc exec kworker2 -- bash -c \"curl -sfL https://get.k3s.io | K3S_URL=https://10.177.108.101:6443 K3S_TOKEN= sh -\" Verify Cluster:\nlxc exec kmaster -- k3s kubectl get nodes Expected:\nNAME STATUS ROLES AGE VERSION kmaster Ready control-plane,master 5m v1.32.3+k3s1 kworker1 Ready 2m v1.32.3+k3s1 kworker2 Ready 1m v1.32.3+k3s1 Set Up Host Access:\nInstall kubectl on the host:\nsudo snap install kubectl --classic Copy kubeconfig:\nlxc file pull kmaster/etc/rancher/k3s/k3s.yaml ~/.kube/config Edit ~/.kube/config, replace 127.0.0.1 with 10.177.108.101:\nserver: https://10.177.108.101:6443 Test:\nkubectl get nodes Add Port Forwarding for K3s API:\nsudo iptables -t nat -A PREROUTING -p tcp --dport 6443 -j DNAT --to-destination 10.177.108.101:6443 sudo iptables -t nat -A POSTROUTING -j MASQUERADE sudo sysctl -w net.ipv4.ip_forward=1 5. Set Up NGINX Ingress and Deploy a Test Service Install Helm:\ncurl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 sudo bash get_helm.sh Install NGINX Ingress:\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx helm repo update helm install ingress-nginx ingress-nginx/ingress-nginx \\ --namespace ingress-nginx \\ --create-namespace \\ --set controller.service.type=LoadBalancer Add Proxy Devices for HTTP/HTTPS:\nBased on your lxc config show kmaster --expanded:\nlxc config device add kmaster http proxy listen=tcp:0.0.0.0:80 connect=tcp:127.0.0.1:80 lxc config device add kmaster https proxy listen=tcp:0.0.0.0:443 connect=tcp:127.0.0.1:443 Add Port Forwarding for HTTP/HTTPS:\nGet NGINX service IP:\nkubectl get svc -n ingress-nginx Example: 10.177.108.x. Forward ports:\nsudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 10.177.108.x:80 sudo iptables -t nat -A PREROUTING -p tcp --dport 443 -j DNAT --to-destination 10.177.108.x:443 sudo iptables -t nat -A POSTROUTING -j MASQUERADE Deploy a Basic NGINX Test Service:\nCreate nginx-test.yaml:\napiVersion: apps/v1 kind: Deployment metadata: name: nginx-test namespace: default spec: replicas: 1 selector: matchLabels: app: nginx-test template: metadata: labels: app: nginx-test spec: containers: - name: nginx image: nginx:latest ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: nginx-test namespace: default spec: ports: - port: 80 targetPort: 80 protocol: TCP selector: app: nginx-test --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: nginx-test namespace: default annotations: nginx.ingress.kubernetes.io/rewrite-target: / spec: ingressClassName: nginx rules: - host: nginx-test.local http: paths: - path: / pathType: Prefix backend: service: name: nginx-test port: number: 80 Apply:\nkubectl apply -f nginx-test.yaml Test the NGINX Service:\nUpdate /etc/hosts on your local machine (temporary workaround since nginx-test.local isn’t a real domain):\necho \" nginx-test.local\" | sudo tee -a /etc/hosts Use your Oracle Cloud instance’s public IP (e.g., curl ifconfig.me). Test:\ncurl http://nginx-test.local Should return the NGINX welcome page HTML. Conclusion You now have a K3s cluster running inside LXC containers managed by LXD, with NGINX Ingress and a basic NGINX test service accessible at http://nginx-test.local. This setup leverages your Oracle Cloud Free Tier instance efficiently, with Traefik disabled and NGINX handling ingress traffic.\n","wordCount":"900","inLanguage":"en","datePublished":"2025-04-21T17:35:27+05:30","dateModified":"2025-04-21T17:35:27+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.rawlani.com/posts/setting-up-lxd-lxc-and-k3s-with-a-basic-nginx-test-service/"},"publisher":{"@type":"Organization","name":"The world wide web, AI, me and my learnings!","logo":{"@type":"ImageObject","url":"https://blog.rawlani.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.rawlani.com/ accesskey=h title="The world wide web, AI, me and my learnings! (Alt + H)">The world wide web, AI, me and my learnings!</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Setting Up Lxd Lxc and K3s With a Basic Nginx Test Service</h1><div class=post-meta><span title='2025-04-21 17:35:27 +0530 +0530'>April 21, 2025</span></div></header><div class=post-content><h1 id=setting-up-lxd-lxc-and-k3s-with-a-basic-nginx-test-service>Setting Up LXD, LXC, and K3s with a Basic NGINX Test Service<a hidden class=anchor aria-hidden=true href=#setting-up-lxd-lxc-and-k3s-with-a-basic-nginx-test-service>#</a></h1><p>This guide details how to set up a lightweight Kubernetes (K3s) cluster using LXD and LXC containers on an Ubuntu 24.04 server, followed by deploying a basic NGINX test service with NGINX Ingress. These steps were tested on an Oracle Cloud Free Tier instance named <code>maata-paarvati</code> with 4 CPUs and 24 GB RAM.</p><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><ul><li>An Ubuntu 24.04 server (e.g., Oracle Cloud Free Tier instance).</li><li>Root or sudo access.</li><li>Network configured to allow TCP ports 80, 443, and 6443.</li></ul><hr><h2 id=1-install-lxd>1. Install LXD<a hidden class=anchor aria-hidden=true href=#1-install-lxd>#</a></h2><ol><li><p><strong>Install LXD via Snap</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo snap install lxd
</span></span></code></pre></div></li><li><p><strong>Initialize LXD</strong>:</p><ul><li><p>Use default settings for a simple setup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo lxd init --auto
</span></span></code></pre></div></li><li><p>This creates a <code>dir</code> storage pool (<code>default</code>) and a bridge network (<code>lxdbr0</code>).</p></li></ul></li><li><p><strong>Add User to LXD Group</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG lxd ubuntu
</span></span><span style=display:flex><span>newgrp lxd
</span></span></code></pre></div></li><li><p><strong>Verify LXD</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc list
</span></span></code></pre></div><ul><li>Should display an empty table initially.</li></ul></li></ol><hr><h2 id=2-create-a-kubernetes-profile-for-lxc-containers>2. Create a Kubernetes Profile for LXC Containers<a hidden class=anchor aria-hidden=true href=#2-create-a-kubernetes-profile-for-lxc-containers>#</a></h2><ol><li><p><strong>Create the Profile Configuration</strong>:</p><ul><li><p>Save this as <code>k8s-profile.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits.cpu</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits.memory</span>: <span style=color:#ae81ff>2GB</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits.memory.swap</span>: <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>linux.kernel_modules</span>: <span style=color:#ae81ff>ip_tables,ip6_tables,nf_nat,overlay,br_netfilter</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>raw.lxc</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    lxc.apparmor.profile=unconfined
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    lxc.cap.drop=
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    lxc.cgroup.devices.allow=a
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    lxc.mount.auto=proc:rw sys:rw</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>security.privileged</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>security.nesting</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>security.syscalls.intercept.mknod</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>security.syscalls.intercept.setxattr</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#ae81ff>LXD profile for Kubernetes</span>
</span></span><span style=display:flex><span><span style=color:#f92672>devices</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>eth0</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>eth0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nictype</span>: <span style=color:#ae81ff>bridged</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>parent</span>: <span style=color:#ae81ff>lxdbr0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>nic</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kmsg</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/dev/kmsg</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>source</span>: <span style=color:#ae81ff>/dev/console</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>unix-char</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>root</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pool</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>disk</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>k8s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>used_by</span>: []
</span></span></code></pre></div></li><li><p>This matches your <code>lxc config show kmaster --expanded</code> output, excluding volatile and proxy settings added later.</p></li></ul></li><li><p><strong>Apply the Profile</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc profile create k8s
</span></span><span style=display:flex><span>lxc profile edit k8s &lt; k8s-profile.yaml
</span></span></code></pre></div></li><li><p><strong>Verify Profile</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc profile show k8s
</span></span></code></pre></div></li></ol><hr><h2 id=3-launch-lxc-containers-with-ubuntu-2404>3. Launch LXC Containers with Ubuntu 24.04<a hidden class=anchor aria-hidden=true href=#3-launch-lxc-containers-with-ubuntu-2404>#</a></h2><ol><li><p><strong>Initialize Containers</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc init ubuntu:24.04 kmaster --profile k8s
</span></span><span style=display:flex><span>lxc init ubuntu:24.04 kworker1 --profile k8s
</span></span><span style=display:flex><span>lxc init ubuntu:24.04 kworker2 --profile k8s
</span></span></code></pre></div></li><li><p><strong>Start Containers</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc start kmaster
</span></span><span style=display:flex><span>lxc start kworker1
</span></span><span style=display:flex><span>lxc start kworker2
</span></span></code></pre></div></li><li><p><strong>Verify Containers</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc list
</span></span></code></pre></div><ul><li><p>Example output (IPs will vary):</p><pre tabindex=0><code>+---------+---------+----------------------+------+-----------+-----------+
|  NAME   |  STATE  |         IPV4         | IPV6 |   TYPE    | SNAPSHOTS |
+---------+---------+----------------------+------+-----------+-----------+
| kmaster | RUNNING | 10.177.108.101 (eth0)|      | CONTAINER | 0         |
| kworker1| RUNNING | 10.177.108.79 (eth0) |      | CONTAINER | 0         |
| kworker2| RUNNING | 10.177.108.57 (eth0) |      | CONTAINER | 0         |
+---------+---------+----------------------+------+-----------+-----------+
</code></pre></li></ul></li></ol><hr><h2 id=4-install-k3s-and-join-the-cluster>4. Install K3s and Join the Cluster<a hidden class=anchor aria-hidden=true href=#4-install-k3s-and-join-the-cluster>#</a></h2><ol><li><p><strong>Prepare</strong> <code>kmaster</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc exec kmaster -- bash -c <span style=color:#e6db74>&#34;apt update &amp;&amp; apt install -y curl iptables&#34;</span>
</span></span></code></pre></div></li><li><p><strong>Install K3s on</strong> <code>kmaster</code>:</p><ul><li><p>Disable Traefik to use NGINX Ingress later:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc exec kmaster -- bash -c <span style=color:#e6db74>&#34;curl -sfL https://get.k3s.io | sh -s - server --disable=traefik --write-kubeconfig-mode 644&#34;</span>
</span></span></code></pre></div></li></ul></li><li><p><strong>Get Node Token</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc exec kmaster -- cat /var/lib/rancher/k3s/server/node-token
</span></span></code></pre></div><ul><li>Save the token (e.g., <code>K10...::server:...</code>).</li></ul></li><li><p><strong>Prepare and Join Worker Nodes</strong>:</p><ul><li><p>For <code>kworker1</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc exec kworker1 -- bash -c <span style=color:#e6db74>&#34;apt update &amp;&amp; apt install -y curl iptables&#34;</span>
</span></span><span style=display:flex><span>lxc exec kworker1 -- bash -c <span style=color:#e6db74>&#34;curl -sfL https://get.k3s.io | K3S_URL=https://10.177.108.101:6443 K3S_TOKEN=&lt;node-token&gt; sh -&#34;</span>
</span></span></code></pre></div></li><li><p>For <code>kworker2</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc exec kworker2 -- bash -c <span style=color:#e6db74>&#34;apt update &amp;&amp; apt install -y curl iptables&#34;</span>
</span></span><span style=display:flex><span>lxc exec kworker2 -- bash -c <span style=color:#e6db74>&#34;curl -sfL https://get.k3s.io | K3S_URL=https://10.177.108.101:6443 K3S_TOKEN=&lt;node-token&gt; sh -&#34;</span>
</span></span></code></pre></div></li></ul></li><li><p><strong>Verify Cluster</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc exec kmaster -- k3s kubectl get nodes
</span></span></code></pre></div><ul><li><p>Expected:</p><pre tabindex=0><code>NAME       STATUS   ROLES                  AGE   VERSION
kmaster    Ready    control-plane,master   5m    v1.32.3+k3s1
kworker1   Ready    &lt;none&gt;                 2m    v1.32.3+k3s1
kworker2   Ready    &lt;none&gt;                 1m    v1.32.3+k3s1
</code></pre></li></ul></li><li><p><strong>Set Up Host Access</strong>:</p><ul><li><p>Install <code>kubectl</code> on the host:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo snap install kubectl --classic
</span></span></code></pre></div></li><li><p>Copy kubeconfig:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc file pull kmaster/etc/rancher/k3s/k3s.yaml ~/.kube/config
</span></span></code></pre></div></li><li><p>Edit <code>~/.kube/config</code>, replace <code>127.0.0.1</code> with <code>10.177.108.101</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://10.177.108.101:6443</span>
</span></span></code></pre></div></li><li><p>Test:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div></li></ul></li><li><p><strong>Add Port Forwarding for K3s API</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo iptables -t nat -A PREROUTING -p tcp --dport <span style=color:#ae81ff>6443</span> -j DNAT --to-destination 10.177.108.101:6443
</span></span><span style=display:flex><span>sudo iptables -t nat -A POSTROUTING -j MASQUERADE
</span></span><span style=display:flex><span>sudo sysctl -w net.ipv4.ip_forward<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div></li></ol><hr><h2 id=5-set-up-nginx-ingress-and-deploy-a-test-service>5. Set Up NGINX Ingress and Deploy a Test Service<a hidden class=anchor aria-hidden=true href=#5-set-up-nginx-ingress-and-deploy-a-test-service>#</a></h2><ol><li><p><strong>Install Helm</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
</span></span><span style=display:flex><span>sudo bash get_helm.sh
</span></span></code></pre></div></li><li><p><strong>Install NGINX Ingress</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
</span></span><span style=display:flex><span>helm repo update
</span></span><span style=display:flex><span>helm install ingress-nginx ingress-nginx/ingress-nginx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --namespace ingress-nginx <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --create-namespace <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set controller.service.type<span style=color:#f92672>=</span>LoadBalancer
</span></span></code></pre></div></li><li><p><strong>Add Proxy Devices for HTTP/HTTPS</strong>:</p><ul><li><p>Based on your <code>lxc config show kmaster --expanded</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc config device add kmaster http proxy listen<span style=color:#f92672>=</span>tcp:0.0.0.0:80 connect<span style=color:#f92672>=</span>tcp:127.0.0.1:80
</span></span><span style=display:flex><span>lxc config device add kmaster https proxy listen<span style=color:#f92672>=</span>tcp:0.0.0.0:443 connect<span style=color:#f92672>=</span>tcp:127.0.0.1:443
</span></span></code></pre></div></li></ul></li><li><p><strong>Add Port Forwarding for HTTP/HTTPS</strong>:</p><ul><li><p>Get NGINX service IP:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get svc -n ingress-nginx
</span></span></code></pre></div><ul><li>Example: <code>10.177.108.x</code>.</li></ul></li><li><p>Forward ports:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo iptables -t nat -A PREROUTING -p tcp --dport <span style=color:#ae81ff>80</span> -j DNAT --to-destination 10.177.108.x:80
</span></span><span style=display:flex><span>sudo iptables -t nat -A PREROUTING -p tcp --dport <span style=color:#ae81ff>443</span> -j DNAT --to-destination 10.177.108.x:443
</span></span><span style=display:flex><span>sudo iptables -t nat -A POSTROUTING -j MASQUERADE
</span></span></code></pre></div></li></ul></li><li><p><strong>Deploy a Basic NGINX Test Service</strong>:</p><ul><li><p>Create <code>nginx-test.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-test</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:latest</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>nginx-test</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nginx.ingress.kubernetes.io/rewrite-target</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingressClassName</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>nginx-test.local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-test</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span></code></pre></div></li><li><p>Apply:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f nginx-test.yaml
</span></span></code></pre></div></li></ul></li><li><p><strong>Test the NGINX Service</strong>:</p><ul><li><p>Update <code>/etc/hosts</code> on your local machine (temporary workaround since <code>nginx-test.local</code> isn’t a real domain):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;&lt;public-ip&gt; nginx-test.local&#34;</span> | sudo tee -a /etc/hosts
</span></span></code></pre></div><ul><li>Use your Oracle Cloud instance’s public IP (e.g., <code>curl ifconfig.me</code>).</li></ul></li><li><p>Test:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl http://nginx-test.local
</span></span></code></pre></div><ul><li>Should return the NGINX welcome page HTML.</li></ul></li></ul></li></ol><hr><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>You now have a K3s cluster running inside LXC containers managed by LXD, with NGINX Ingress and a basic NGINX test service accessible at <code>http://nginx-test.local</code>. This setup leverages your Oracle Cloud Free Tier instance efficiently, with Traefik disabled and NGINX handling ingress traffic.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.rawlani.com/>The world wide web, AI, me and my learnings!</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>